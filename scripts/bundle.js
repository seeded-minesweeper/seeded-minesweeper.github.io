(()=>{"use strict";var __webpack_modules__={6(t,e,s){function*i(t){for(;;){let e=t+=1831565813;e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),yield((e^e>>>14)>>>0)/4294967296}}function a(t){return document.querySelector(t)}function n(t,e,s){return t>=e&&t<=s}function r(t){let e=0;for(let s=0;s<t.length;s++)e+=Math.pow(31*t[s].charCodeAt(0),t.length-s),e&=e;return e}s.d(e,{$0:()=>h,BH:()=>i,DD:()=>d,Jt:()=>a,XO:()=>m,XU:()=>c,bQ:()=>u,r4:()=>n,s5:()=>r,yN:()=>l,yT:()=>p});let o=(t,e)=>({x:t,y:e});const l=[o(-1,0),o(1,0),o(0,-1),o(0,1),o(-1,-1),o(-1,1),o(1,-1),o(1,1)];function h(t,e,s=500){let i;t.addEventListener("touchstart",()=>{i=setTimeout(()=>{e()},s)}),["touchmove","touchend"].forEach(e=>{t.addEventListener(e,()=>clearTimeout(i))}),t.addEventListener("contextmenu",t=>{t.preventDefault(),e()})}function c(t,e=!0){let s=Math.pow(2,t-(e?1:0)),i=e?-s:0;return Math.floor(Math.random()*(s-i))+i}function p(t,e){return Math.round(Math.random()*(e-t))+t}function d(t){let e=function(t){let e=t%86400,s=e%3600;return{days:Math.floor(t/86400),hrs:Math.floor(e/3600),mins:Math.floor(s/60),secs:s%60}}(t),s=["d","h","m","s"],i=0,a="";for(const t in e)a+=e[t]?e[t]+s[i]+" ":"",i++;return t?a.trim():"0s"}function u(t,e=!1){return JSON.parse(e?sessionStorage.getItem(t):localStorage.getItem(t))}function m(t,e,s=!1){s?sessionStorage.setItem(t,JSON.stringify(e)):localStorage.setItem(t,JSON.stringify(e))}},104(t,e,s){s.d(e,{A:()=>r});var i=s(823),a=s(6);class n extends i.A{app;textElem=(0,a.Jt)("#confirm-body");okBtn=(0,a.Jt)("#ct-ok-btn");cancelBtn=(0,a.Jt)("#ct-cancel-btn");constructor(){super((0,a.Jt)("#confirm-tab"))}open(t,e=!0){return super.open(),this.textElem.innerHTML=t,e?this.okBtn.focus():this.cancelBtn.focus(),new Promise(t=>{let e=e=>{t(e),this.close()};this.okBtn.onclick=()=>e(!0),this.cancelBtn.onclick=()=>e(!1)})}}const r=new n},250(t,e,s){s.d(e,{A:()=>r});var i=s(823),a=s(6);class n extends i.A{body=(0,a.Jt)("#info-tab-body");constructor(){super((0,a.Jt)("#info-tab"),(0,a.Jt)("#info-tab-head button"))}open(t=""){super.open(),this.body.innerHTML="","string"==typeof t?this.body.innerHTML=t:this.body.appendChild(t)}}const r=new n},669(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _tab_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(823),_confirm_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(104),_info_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(250),_game_minesweeper_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(879),_utils_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(6);class NewGameTab extends _tab_js__WEBPACK_IMPORTED_MODULE_0__.A{get rowsVal(){return Number(this.rowsInput.value)}get colsVal(){return Number(this.colsInput.value)}get minesVal(){return Number(this.minesInput.value)}_fullSeedMode=!1;get fullSeedMode(){return this._fullSeedMode}set fullSeedMode(t){let{rowsVal:e,colsVal:s,minesVal:i}=this,a=this.seedInput.value;if(this._fullSeedMode=t,this.elem.dataset.fsmode=Number(this.fullSeedMode),this.clearInputs(),this.fullSeedMode){if(e>=1&&s>=1&&i<e*s){let t=0==a.length?(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.XU)(48):a;this.seedInput.value=_game_minesweeper_js__WEBPACK_IMPORTED_MODULE_3__.default.getFullSeed(e,s,i,t)}}else if(_game_minesweeper_js__WEBPACK_IMPORTED_MODULE_3__.default.isValidSeed(a)){let{rows:t,cols:e,mines:s,seed:i}=_game_minesweeper_js__WEBPACK_IMPORTED_MODULE_3__.default.decodeFullSeed(a);this.rowsInput.value=t,this.colsInput.value=e,this.minesInput.value=s,this.seedInput.value=i}this.updateElems()}fsSwitchBtn=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#top-wrap button:first-of-type");createBtn=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#create-btn");presetSaveBtn=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#preset-save-btn");presetsBtn=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#presets-btn");presetsDropdown=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#presets-dropdown");rowsInput=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#rows-input");colsInput=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#cols-input");minesInput=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#mines-input");seedInput=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#seed-input");randSeedBtn=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#rand-seed-btn");estTimeText=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#ng-est-time");infoBtn=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#top-wrap button:nth-of-type(2)");presetSaveWrap=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#preset-save-wrap");newGameInfoWrap=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#new-game-info-wrap");constructor(){super((0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#new-game-tab"),(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#ngt-head button")),this.fsSwitchBtn.onclick=()=>{this.fullSeedMode=!this.fullSeedMode},this.randSeedBtn.onclick=()=>{this.seedInput.value=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.XU)(48),this.updateElems()},this.rowsInput.oninput=this.colsInput.oninput=this.minesInput.oninput=this.seedInput.oninput=()=>this.updateElems(),this.createBtn.onclick=()=>{let t,e,s,i;if(this.fullSeedMode){let a=_game_minesweeper_js__WEBPACK_IMPORTED_MODULE_3__.default.decodeFullSeed(this.seedInput.value);t=a.rows,e=a.cols,s=a.mines,i=a.seed}else t=this.rowsVal,e=this.colsVal,s=this.minesVal,i=this.seedInput.value,0==i.length&&(i=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.XU)(48));this.app.newGame(t,e,s,i),this.close()},this.presetSaveBtn.onclick=()=>{_info_js__WEBPACK_IMPORTED_MODULE_2__.A.open(this.presetSaveWrap);let t,e,s,i,a="p:nth-of-type(2)",n=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#ps-rows "+a),r=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#ps-cols "+a),o=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#ps-mines "+a),l=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#ps-seed "+a),h=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#ps-name-input"),c=(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.Jt)("#ps-save-btn");if(this.fullSeedMode){let a=_game_minesweeper_js__WEBPACK_IMPORTED_MODULE_3__.default.decodeFullSeed(this.seedInput.value);t=a.rows,e=a.cols,s=a.mines,i=a.seed}else t=this.rowsVal,e=this.colsVal,s=this.minesVal,i=this.seedInput.value;c.disabled=!0,h.value="",n.textContent=t,r.textContent=e,o.textContent=s,String(i).length>0?l.textContent=i:l.innerHTML="<i>Random</i>",h.oninput=()=>{c.disabled=0==h.value.trim().length},c.onclick=()=>{let a=h.value.trim(),n=()=>{this.app.presets.add(a,t,e,s,i),_info_js__WEBPACK_IMPORTED_MODULE_2__.A.close(),this.updateElems()};this.app.presets.has(a)?_confirm_js__WEBPACK_IMPORTED_MODULE_1__.A.open("A preset with this name already exists, do you want to overwrite its properties?",!1).then(t=>{t&&(this.app.presets.remove(a),n())}):n()}};let close=()=>{this.presetsBtn.dataset.active=!1,this.presetsDropdown.classList.add("hide-2")};this.presetsBtn.onclick=()=>{if(!this.app.presets.arr.length)return;this.presetsDropdown.innerHTML="";let bool=eval(this.presetsBtn.dataset.active);this.presetsBtn.dataset.active=!bool,bool?close():(this.presetsDropdown.classList.remove("hide-2"),this.app.presets.arr.forEach(t=>{let e=document.createElement("div"),s=document.createElement("button");e.classList.add("pd-item"),e.appendChild(s),s.textContent=t.name,s.classList.add("ctx-elem"),s.onclick=()=>{close(),this.fullSeedMode=!1,this.rowsInput.value=t.rows||"",this.colsInput.value=t.cols||"",this.minesInput.value=t.mines||"",this.seedInput.value=t.seed||"",this.updateElems()},(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.$0)(s,()=>{this.app.audio.play("click"),close(),_confirm_js__WEBPACK_IMPORTED_MODULE_1__.A.open(`Delete preset: <b>${t.name}</b>`,!1).then(e=>{e&&this.app.presets.remove(t.name),this.updateElems()})}),this.presetsDropdown.appendChild(e)}))},document.addEventListener("click",t=>{this.presetsBtn.contains(t.target)||this.presetsDropdown.contains(t.target)||close()}),this.infoBtn.addEventListener("click",()=>{_info_js__WEBPACK_IMPORTED_MODULE_2__.A.open(this.newGameInfoWrap)}),this.presetSaveWrap.remove(),this.newGameInfoWrap.remove()}open(t=!1){super.open(),this.fullSeedMode=!1,this.clearInputs(),t&&(this.rowsInput.value=this.app.curGame.rows,this.colsInput.value=this.app.curGame.cols,this.minesInput.value=this.app.curGame.mines,this.seedInput.value=this.app.curGame.seed),this.updateElems()}close(){super.close(),this.curTimeWorker&&this.curTimeWorker.terminate()}curTimeWorker;updateElems(){this.presetsBtn.disabled=!this.app.presets.arr.length,this.randSeedBtn.disabled=this.fullSeedMode;let t=e=>{let s=e.value;return e.value=s.replace("-","").replace(".",""),t};t(this.rowsInput)(this.colsInput)(this.minesInput),this.estTimeText.classList.add("hide-2"),this.estTimeText.innerHTML='<div class="wait-anim"></div>',this.curTimeWorker&&this.curTimeWorker.terminate();let e=t=>{t.val||(this.estTimeText.textContent="Est Time: "+(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.DD)(t.minTime)+(t.minTime!=t.maxTime?" - "+(0,_utils_js__WEBPACK_IMPORTED_MODULE_4__.DD)(t.maxTime):""))};if(this.fullSeedMode)this.createBtn.disabled=this.presetSaveBtn.disabled=!_game_minesweeper_js__WEBPACK_IMPORTED_MODULE_3__.default.isValidSeed(this.seedInput.value),this.createBtn.disabled||(this.estTimeText.classList.remove("hide-2"),this.curTimeWorker=this.app.getEstTime(this.seedInput.value,e));else{let{rowsVal:t,colsVal:s,minesVal:i}=this;this.createBtn.disabled=this.presetSaveBtn.disabled=t<1||s<1||i>=t*s,!this.createBtn.disabled&&this.seedInput.value.length>0&&(this.estTimeText.classList.remove("hide-2"),this.curTimeWorker=this.app.getEstTime(_game_minesweeper_js__WEBPACK_IMPORTED_MODULE_3__.default.getFullSeed(t,s,i,this.seedInput.value),e))}}clearInputs(){this.rowsInput.value=this.colsInput.value=this.minesInput.value=this.seedInput.value="",this.createBtn.disabled=this.presetSaveBtn.disabled=!0}}const newGameTab=new NewGameTab,__WEBPACK_DEFAULT_EXPORT__=newGameTab},823(t,e,s){s.d(e,{A:()=>i});class i extends EventTarget{app;constructor(t,e){super(),this.elem=t,this.wrap=t.parentElement,e&&(this.closeBtn=e,this.closeBtn.addEventListener("click",()=>this.close()))}#t=new CustomEvent("open");open(){this.wrap.open||(this.wrap.showModal(),this.wrap.classList.remove("hide"),this.dispatchEvent(this.#t))}#e=new CustomEvent("close");close(){this.wrap.classList.add("hide");let t=()=>{this.wrap.close(),this.dispatchEvent(this.#e)};0==getComputedStyle(this.wrap).opacity?t():this.wrap.addEventListener("transitionend",()=>t(),{once:!0})}}},879(t,e,s){s.d(e,{default:()=>n});var i=s(6);class a{row=0;col=0;rigged=!1;opened=!1;flagged=!1;mineCount=0;chainCount;neighbours=[];updateMineCount(){this.mineCount=this.rigged?"M":this.neighbours.filter(t=>t.rigged).length}updateNeighbours(){this.neighbours=i.yN.map(t=>this.game.sqrAt(this.row+t.x,this.col+t.y)).filter(t=>t)}constructor(t,e,s){this.game=t,this.row=e,this.col=s}}class n{sqrs=[];openedArr=[];type="standard";get started(){return this.sqrs.some(t=>1==t.opened)}get rigged(){return this.sqrs.filter(t=>t.rigged)}get opened(){return this.sqrs.filter(t=>t.opened&&!t.rigged)}get won(){return this.sqrs.every(t=>t.opened&&!t.rigged||t.rigged&&!t.opened)}get failed(){return this.sqrs.some(t=>t.opened&&t.rigged)}get ended(){return this.failed||this.won}get fullSeed(){return n.getFullSeed(this.rows,this.cols,this.mines,this.seed)}constructor(t,e,s,i){if("number"==typeof t)this.rows=t,this.cols=e,this.seed=i,this.mines=s;else{let{rows:t,cols:e,mines:s,seed:i}=n.decodeFullSeed(arguments[0]);this.rows=t,this.cols=e,this.seed=i,this.mines=s}this.flagCount=this.mines,this.createSqrs(),this.rigSquares(),this.sqrs.forEach(t=>{t.updateNeighbours(),t.updateMineCount()})}createSqrs(){this.sqrs=new Array(this.rows*this.cols).fill();let t=1,e=1;this.sqrs.forEach((s,i)=>{this.sqrs[i]=new a(this,t,e),(i+1)%this.cols==0?(t++,e=1):e++})}rigSquares(){let t=isNaN(Number(this.seed))?(0,i.s5)(this.seed):Number(this.seed),e=(0,i.BH)(t*this.mines);this.sqrs.map(t=>t).sort(()=>e.next().value>e.next().value?1:-1).reverse().sort(()=>e.next().value>e.next().value?-1:1).slice(0,this.mines).forEach(t=>t.rigged=!0),e.return()}sqrAt(t,e){let s=(t,e)=>t>0&&t<=e;if(s(t,this.rows)&&s(e,this.cols))return this.sqrs[this.cols*(t-1)+(e-1)]}openSqr(t,e){let s=this.sqrAt(t,e);if(this.openedArr.forEach(t=>t.chainCount=null),this.openedArr=[],!this.ended&&s){if(s.chainCount=0,s.opened||s.flagged){let t=s.neighbours.filter(t=>!t.flagged&&!t.opened),e=s.neighbours.filter(t=>t.flagged).length;s.mineCount==e&&t.forEach(t=>{t.chainCount=0,this.openedArr.push(t)})}else this.openedArr.push(s);for(const t of this.openedArr)if(t.opened=!0,t.mineCount||t.neighbours.forEach(e=>{e.opened||e.flagged||null!=e.chainCount||(e.chainCount=t.chainCount+1,this.openedArr.push(e))}),t.opened&&t.rigged)break}}flagSqr(t,e){let s=this.sqrAt(t,e);s&&!s.opened&&!s.flagged&&this.flagCount&&!this.ended&&this.started&&(s.flagged=!0,this.flagCount--)}unflagSqr(t,e){let s=this.sqrAt(t,e);s&&s.flagged&&!this.ended&&(s.flagged=!1,this.flagCount++)}toggleFlag(t,e){let s=this.sqrAt(t,e);s&&(s.flagged?this.unflagSqr(s.row,s.col):this.flagSqr(s.row,s.col))}getStringData(){let t="";return t+=this.seed+"\n",this.sqrs.forEach(e=>{let s=e.opened?"o":e.flagged?"f":"c";e.rigged&&(s=s.toUpperCase()),t+=s,e.col==this.cols&&e.row!=this.rows&&(t+="\n")}),t}static getFullSeed(t,e,s,a){let n=t.toString(16)+"#"+e.toString(16)+"#"+s.toString(16)+"#"+(isNaN(Number(a))?(0,i.s5)(a):Number(a)).toString(16),r=(0,i.BH)(n.length);return n.split("").sort(()=>r.next().value>.5?1:-1).join("")}static decodeFullSeed(t){let e=(0,i.BH)(t.length),s=new Array(t.length).fill().map((t,e)=>e).sort(()=>e.next().value>.5?1:-1),a=s.map((e,i)=>t[s.indexOf(i)]).join("").split("#");function n(t){if(t){let e=t.replace("-",""),s=t.includes("-");return Number("0x"+e)*(s?-1:1)}}return{rows:n(a[0]),cols:n(a[1]),mines:n(a[2]),seed:n(a[3])}}static isValidSeed(t){let e=n.decodeFullSeed(t);return!(isNaN(e.rows)||isNaN(e.cols)||isNaN(e.mines)||isNaN(e.seed))}static createFromString(t){let e=t.split("\n"),s=e.length-1,i=e[1].length,a=new n(s,i,0,e[0]);for(const t of a.sqrs){let s=e[t.row][t.col-1],i=s.toLowerCase()!=s;switch(s=s.toLowerCase(),t.rigged=i,i&&(a.mines++,a.flagCount++),s){case"o":t.opened=!0;break;case"f":t.flagged=!0,a.flagCount--}}return a.sqrs.forEach(t=>{t.updateMineCount(),t.updateNeighbours()}),a}}}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var s=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](s,s.exports,__webpack_require__),s.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.d=(t,e)=>{for(var s in e)__webpack_require__.o(e,s)&&!__webpack_require__.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},__webpack_require__.u=t=>t+".bundle.js",__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;__webpack_require__.g.importScripts&&(t=__webpack_require__.g.location+"");var e=__webpack_require__.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var s=e.getElementsByTagName("script");if(s.length)for(var i=s.length-1;i>-1&&(!t||!/^http(s?):/.test(t));)t=s[i--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=t})(),__webpack_require__.b="undefined"!=typeof document&&document.baseURI||self.location.href;var __webpack_exports__={},minesweeper=__webpack_require__(879);class AppSquare{row=0;col=0;alpha=1;input=!0;opened=!1;flagged=!1;mineCount=null;overlayColor=null;get x(){return(this.col-1)*this.app.sqrSize+this.app.sqrSize/2}get y(){return(this.row-1)*this.app.sqrSize+this.app.sqrSize/2}get startX(){return this.x-this.app.sqrSize/2}get startY(){return this.y-this.app.sqrSize/2}get endX(){return this.x+this.app.sqrSize/2}get endY(){return this.y+this.app.sqrSize/2}constructor(t,e,s,i,a=!1,n=!1){this.app=t,this.row=e,this.col=s,this.mineCount=i||null,this.opened=a,this.flagged=n}}class ExplosionSprite{scale=1;alpha=1;get startX(){return this.x-this.size*this.scale/2}get startY(){return this.y-this.size*this.scale/2}get endX(){return this.startX+this.size*this.scale}get endY(){return this.startY+this.size*this.scale}constructor(t,e,s,i=1){this.app=t,this.size=t.sqrSize,this.x=e,this.y=s,this.frame=i,this.app.explosions.push(this)}timeObjs=[];explode(){this.timeObjs.forEach(t=>{t&&t.stop()}),this.timeObjs=[],this.alpha=1;let t=this.app.addCounter({from:0,to:1,duration:200,onUpdate:t=>{this.frame=Math.floor(9*t.value),this.scale=1.5*t.value+.5}}).start(),e=this.app.addTimeEvent(()=>{let t=this.app.addCounter({from:1,to:0,duration:50,onUpdate:t=>this.alpha=t.value}).start();this.timeObjs.push(t)},150);return this.timeObjs.push(e,t),this.app.audio.playSpatial("explosion",this.x,this.y),this}destroy(){this.timeObjs.forEach(t=>t.stop()),this.app.explosions=this.app.explosions.filter(t=>t!=this)}draw(){let t=this.app.ctx,e=this.app.explosionImg,s=e.width/11;t.restore(),t.save(),t.globalAlpha=this.alpha,t.translate(this.x,this.y),t.scale(this.scale,this.scale),t.fillStyle="black",t.drawImage(e,this.frame*s,0,s,e.height,-this.size/2,-this.size/2,this.size,this.size)}}class Flag{scale=1;rotation=0;angularVelocity=0;maxAngularVelocity=1/0;angularAcceleration=0;velocity={x:0,y:0};maxVelocity={x:10,y:50};acceleration={x:0,y:0};constructor(t,e,s){this.app=t,this.x=e,this.y=s,this.size=t.sqrSize,this.app.flags.push(this)}update(t){let e=this.app.fps/(1e3/t);this.velocity.x+=this.acceleration.x*e,this.velocity.y+=this.acceleration.y*e,Math.abs(this.velocity.x)>this.maxVelocity.x&&(this.velocity.x=this.maxVelocity.x*(Math.abs(this.velocity.x)==this.velocity.x?1:-1)),Math.abs(this.velocity.y)>this.maxVelocity.y&&(this.velocity.y=this.maxVelocity.y*(Math.abs(this.velocity.y)==this.velocity.y?1:-1)),this.x+=this.velocity.x*e,this.y+=this.velocity.y*e,this.angularVelocity+=this.angularAcceleration*e,Math.abs(this.angularVelocity)>this.maxAngularVelocity&&(this.angularVelocity=this.maxAngularVelocity*(Math.abs(this.angularVelocity)==this.angularVelocity?1:-1)),this.rotation+=this.angularVelocity*e}scaleCounter;leave(){this.app.audio.play("unflag"),this.velocity.y=-5,this.acceleration.y=.1,this.velocity.x=6*Math.random()-3;let t=[.01,-.01];this.angularAcceleration=t[Math.floor(Math.random()*t.length)],this.maxAngularVelocity=.05,this.scaleCounter=this.app.addCounter({duration:2e3,from:this.scale,to:0,onUpdate:t=>this.scale=t.value,onComplete:()=>this.destroy()}).start()}destroy(){this.scaleCounter&&this.scaleCounter.stop(),this.app.flags=this.app.flags.filter(t=>t!=this)}draw(){let t=this.app.ctx;t.restore(),t.save();let e=.8*this.app.sqrSize,s=this.app.flagImg.height/this.app.flagImg.width*e;t.translate(this.x,this.y),t.scale(this.scale,this.scale),t.rotate(this.rotation),t.drawImage(this.app.flagImg,-e/2,-s/2,e,s)}}class TimeEvent{constructor(t,e,s=1){this.cb=t,this.delay=e,this.loop=s,this.timeLeft=this.delay,this.loopsLeft=this.loop}stop(){this.started=!1,this.timeLeft=0,this.loopsLeft=0}update(t){if(this.loopsLeft&&(this.timeLeft-=t,this.timeLeft<=0&&(this.loopsLeft--,this.cb()),this.loopsLeft&&this.timeLeft<=0)){let t=()=>{this.timeLeft=this.timeLeft+this.delay,this.timeLeft<=0&&(this.loopsLeft--,this.cb(),this.loopsLeft&&t())};t()}}}let pi=Math.PI,cos=Math.cos,sin=Math.sin;class Counter extends EventTarget{value=0;curTime=0;ease="linear";easeFuncs={linear:t=>t,outSine:t=>sin(t*pi/2),inSine:t=>1-cos(t*pi/2),inOutSine:t=>-(cos(pi*t)-1)/2};constructor(t,e){super(),this.app=t,this.to=e.to,this.from=e.from,this.duration=e.duration,this.ease=e.ease||"linear",this.steps=e.steps||30,this.onUpdate=e.onUpdate||(()=>{}),this.onComplete=e.onComplete||(()=>{})}_updateEv=new CustomEvent("update",{detail:this});_completeEv=new CustomEvent("complete",{detail:this});start(){return this.value=0,this.curTime=0,this.tE=this.app.addTimeEvent(()=>{this.curTime+=this.duration/this.steps,this.value=(this.to-this.from)*this.easeFuncs[this.ease](this.curTime/this.duration)+this.from,0==this.tE.loopsLeft&&(this.value=this.to,this.onComplete(this),this.dispatchEvent(this._completeEv)),this.onUpdate(this),this.dispatchEvent(this._updateEv)},this.duration/this.steps,this.steps),this}stop(){this.tE&&this.tE.stop()}}var utils=__webpack_require__(6),new_game=__webpack_require__(669);class Input{disabled=!1;canvas;constructor(t){this.app=t,this.canvas=this.app.canvas;let e,s,i,a=()=>{s=null,clearTimeout(i)};this.canvas.addEventListener("touchstart",({touches:t})=>{if(!this.disabled)if(e=t,1==t.length){let{x:e,y:n}=this.getWorldFromClient(t[0].clientX,t[0].clientY),r=this.getSqr(e,n);r&&(s=r,i=setTimeout(()=>{this.app.flagSqr(s),a();let t=this.app.audio.ctx.listener;t.positionX.value=e,t.positionY.value=n},500))}else a()}),this.canvas.addEventListener("touchmove",t=>{if(!this.disabled){let{touches:s}=t;if(t.preventDefault(),a(),1==s.length){let t=s[0],i=e[0];this.app.camera.x-=Math.floor(t.clientX-i.clientX)*this.app.settings.scrollSensitivity,this.app.camera.y-=Math.floor(t.clientY-i.clientY)*this.app.settings.scrollSensitivity,this.app.scrollBar.show(),e=s}else if(2==s.length&&2==e.length){let t=this.getWorldFromClient(s[0].clientX,s[0].clientY),i=this.getWorldFromClient(s[1].clientX,s[1].clientY),a=this.getWorldFromClient(e[0].clientX,e[0].clientY),n=this.getWorldFromClient(e[1].clientX,e[1].clientY),r={x:Math.floor((t.x+i.x)/2),y:Math.floor((t.y+i.y)/2)},o=Math.hypot(t.x-i.x,t.y-i.y)/Math.hypot(a.x-n.x,a.y-n.y);this.app.camera.setOriginSafe((r.x-this.app.camera.startX)/this.app.camera.scrollW,(r.y-this.app.camera.startY)/this.app.camera.scrollH),this.app.camera.zoom*=o,e=s}}}),this.canvas.addEventListener("touchend",()=>a());let n,r,o="off";document.addEventListener("keydown",({key:t})=>{if("Control"==t&&!this.disabled){switch(o){case"in":o="out";break;case"out":o="off";break;case"off":o="in"}this.canvas.style.cursor="in"==o?"zoom-in":"out"==o?"zoom-out":"default"}}),this.canvas.addEventListener("click",({offsetX:t,offsetY:e})=>{if(!this.disabled){let s=this.getRenderFromOffset(t,e);if(s.inBounds){let{x:t,y:e}=this.toWorldSpace(s.x,s.y),i=this.app.audio.ctx.listener;if(i.positionX.value=t,i.positionY.value=e,"off"==o){let s=this.getSqr(t,e);n?(clearTimeout(r),n==s&&this.app.openSqr(s),n=null):(n=s,r=setTimeout(()=>n=null,700))}else{let s=(t-this.app.camera.startX)/this.app.camera.scrollW,i=(e-this.app.camera.startY)/this.app.camera.scrollH;this.app.camera.setOriginSafe(s,i),this.app.camera.zoom+="in"==o?.2:-.2}}}}),this.canvas.addEventListener("contextmenu",t=>{if(t.preventDefault(),!this.disabled&&0==navigator.maxTouchPoints&&this.getRenderFromOffset(t.offsetX,t.offsetY).inBounds){let{x:e,y:s}=this.toWorldSpace(t.offsetX,t.offsetY),i=this.getSqr(e,s),a=this.app.audio.ctx.listener;a.positionX.value=e,a.positionY.value=s,i&&this.app.flagSqr(i)}});let l,h=!1,c=()=>{h=!1,"off"==o&&(this.canvas.style.cursor="default")};this.canvas.addEventListener("mousedown",t=>{h=!0,l=t}),this.canvas.addEventListener("mouseup",c),this.canvas.addEventListener("mouseleave",c),this.canvas.addEventListener("mousemove",t=>{0!=navigator.maxTouchPoints||this.disabled||(n=null,h&&(this.app.camera.stopMoving(),"off"==o&&(this.app.camera.locked.x&&this.app.camera.locked.y||(this.canvas.style.cursor="grabbing")),this.app.camera.x-=Math.floor(t.x-l.x)*this.app.settings.scrollSensitivity,this.app.camera.y-=Math.floor(t.y-l.y)*this.app.settings.scrollSensitivity,this.app.scrollBar.show(),l=t))}),document.addEventListener("keydown",({key:t})=>{if(!this.disabled){if("Escape"==t){let t=this.app.openTabs[this.app.openTabs.length-1];t&&t.closeBtn&&t.close()}if(this.app.canvas.matches(":focus"))switch(t.includes("Arrow")&&this.app.scrollBar.show(),t){case"ArrowUp":this.app.camera.y-=2*this.app.settings.scrollSensitivity;break;case"ArrowDown":this.app.camera.y+=2*this.app.settings.scrollSensitivity;break;case"ArrowLeft":this.app.camera.x-=2*this.app.settings.scrollSensitivity;break;case"ArrowRight":this.app.camera.x+=2*this.app.settings.scrollSensitivity}}})}toWorldSpace(t,e){return{x:this.app.camera.startX+t/this.app.camera.width/devicePixelRatio*this.app.camera.scrollW,y:this.app.camera.startY+e/this.app.camera.height/devicePixelRatio*this.app.camera.scrollH}}getWorldFromClient(t,e){let s=this.getRenderFromClient(t,e);return this.toWorldSpace(s.x,s.y)}getOffsetFromClient(t,e){let s=this.canvas.getBoundingClientRect(),i=getComputedStyle(this.canvas),a=parseInt(i.borderLeftWidth),n=parseInt(i.borderTop);return{x:Math.round(t-s.x-a),y:Math.round(e-s.y-n)}}getRenderFromOffset(t,e){let s=getComputedStyle(this.canvas),i=parseInt(s.paddingLeft),a=parseInt(s.paddingTop),n=(t-i)/parseInt(s.width),r=(e-a)/parseInt(s.height);return{x:this.canvas.width*n,y:this.canvas.height*r,inBounds:n>=0&&n<=1&&r>=0&&r<=1}}getRenderFromClient(t,e){let s=this.getOffsetFromClient(t,e);return this.getRenderFromOffset(s.x,s.y)}getSqr(t,e){return this.app.sqrs.find(s=>(0,utils.r4)(t,s.startX,s.endX)&&(0,utils.r4)(e,s.startY,s.endY)&&s.input)}}const ceil=Math.ceil;class Camera{_x=0;_y=0;set x(t){this._x=t}get x(){return this._x}set y(t){this._y=t}get y(){return this._y}width=0;height=0;_zoom=1;get zoom(){return this._zoom}set zoom(t){this._zoom=t,this._zoom=Math.max(this.app.settings.minZoom,this._zoom),this._zoom=Math.min(this.app.settings.maxZoom,this._zoom),this.app.audio.resetPos()}origin={x:0,y:0};locked={x:!1,y:!1};get scrollW(){return ceil(this.width/this.zoom)}get scrollH(){return ceil(this.height/this.zoom)}get startX(){return ceil(this.x-this.scrollW*this.origin.x)}get startY(){return ceil(this.y-this.scrollH*this.origin.y)}get endX(){return this.startX+this.scrollW}get endY(){return this.startY+this.scrollH}get centerX(){return this.startX+this.scrollW/2}get centerY(){return this.startY+this.scrollH/2}get obj(){return{x:this.x,y:this.y,zoom:this.zoom}}constructor(t){this.app=t}setOriginSafe(t,e){let s=this.startX+t*this.scrollW,i=this.startY+e*this.scrollH;this.x=s,this.y=i,this.origin.x=t,this.origin.y=e}moveCounters=[];moveTo(t,e,s=500){this.stopMoving();let i={duration:s,ease:"outSine",steps:Math.round(1e3/this.curDelta)},a=this.app.addCounter({from:this.x,to:t,...i,onUpdate:t=>this.x=Math.floor(t.value)}).start(),n=this.app.addCounter({from:this.y,to:e,...i,onUpdate:t=>this.y=Math.floor(t.value)}).start();this.moveCounters.push(a,n)}stopMoving(){this.moveCounters.forEach(t=>t.stop()),this.moveCounters=[]}update(t){this.curDelta=t;let e=this.app.sqrSize*this.app.curGame.cols*this.zoom,s=this.app.sqrSize*this.app.curGame.rows*this.zoom;e<this.width?(this.origin.x=.5,this.x=e/this.zoom/2):(this.setOriginSafe(0,this.origin.y),this.startX<0?this.x=0:this.endX>e/this.zoom&&(this.x=e/this.zoom-this.scrollW)),s<this.height?(this.origin.y=.5,this.y=s/this.zoom/2):(this.setOriginSafe(this.origin.x,0),this.startY<0?this.y=0:this.endY>s/this.zoom&&(this.y=s/this.zoom-this.scrollH)),this.locked.x=e<this.width,this.locked.y=s<this.height}}class ScrollBar{alpha=0;hideCounter;hideDelay;constructor(t){this.app=t}show(){this.alpha=1,this.hide()}hide(){this.hideDelay&&this.hideDelay.stop(),this.hideCounter&&this.hideCounter.stop(),this.hideDelay=this.app.addTimeEvent(()=>{this.hideCounter=this.app.addCounter({from:1,to:0,duration:500,onUpdate:t=>{this.alpha=t.value}}).start()},2e3)}draw(){let t=this.app.ctx,e=this.app.camera,s=this.app.curGame.cols*this.app.sqrSize,i=this.app.curGame.rows*this.app.sqrSize,a=5/devicePixelRatio;t.restore(),t.save(),t.fillStyle="#0005",t.globalAlpha=this.alpha;let n=e.scrollW,r=e.scrollW/s*e.scrollW,o=e.startX/s*e.scrollW;r<n&&t.fillRect(e.startX+o,e.startY,r,a);let l=e.scrollH,h=e.scrollH/i*e.scrollH,c=e.startY/i*e.scrollH;h<l&&t.fillRect(e.startX,e.startY+c,a,h)}}var tab=__webpack_require__(823),tabs_confirm=__webpack_require__(104),tabs_info=__webpack_require__(250);class StatsTab extends tab.A{_state=0;get state(){return this._state}set state(t){this._state=t,this.slFilterBtn.textContent=0==t?"All":1==t?"Won":2==t?"Lost":"All",this.openListElem()}get stats(){return this.app.stats}stateArr=[[!0,!0],[!0,!1],[!1,!0]];mainElem=(0,utils.Jt)("#stats-main");playedBtn=(0,utils.Jt)("#stats-gp");winBtn=(0,utils.Jt)("#stats-gw");lostBtn=(0,utils.Jt)("#stats-gl");clearBtn=(0,utils.Jt)("#clear-stats-btn");masteryBtn=(0,utils.Jt)("#stats-mastery");listElem=(0,utils.Jt)("#stats-list");slBackBtn=(0,utils.Jt)("#sl-back-btn");slFilterWrap=(0,utils.Jt)("#sl-filter-wrap");slFilterBtn=(0,utils.Jt)("#sl-filter-wrap > button");slFilterDropdown=(0,utils.Jt)("#sl-filter-dropdown");tableBody=(0,utils.Jt)("#sl-body tbody");masteryPointsInfo=(0,utils.Jt)("#mastery-points-info-wrap");constructor(){super((0,utils.Jt)("#stats-tab"),(0,utils.Jt)("#stats-head button")),this.clearBtn.addEventListener("click",async()=>{await tabs_confirm.A.open("Clear all stats data?",!1)&&(this.app.stats.clear(),this.updateElems())}),this.playedBtn.addEventListener("click",()=>this.state=0),this.winBtn.addEventListener("click",()=>this.state=1),this.lostBtn.addEventListener("click",()=>this.state=2),this.masteryBtn.addEventListener("click",()=>{tabs_info.A.open(this.masteryPointsInfo)}),this.slBackBtn.addEventListener("click",()=>this.backToMain()),this.slFilterBtn.addEventListener("click",()=>{let t=this.slFilterWrap.dataset.active;this.slFilterWrap.dataset.active="1"==t?"0":"1"}),document.addEventListener("click",t=>{this.slFilterBtn.contains(t.target)||(this.slFilterWrap.dataset.active="0")}),[...this.slFilterDropdown.children].forEach((t,e)=>t.addEventListener("click",()=>this.state=e)),this.masteryPointsInfo.remove()}open(){super.open(),this.updateElems(),this.backToMain()}updateElems(){this.playedBtn.children[1].textContent=this.stats.gamesPlayed.length,this.winBtn.children[1].textContent=this.stats.won.length,this.lostBtn.children[1].textContent=this.stats.lost.length,this.masteryBtn.children[1].textContent=this.stats.getMasteryPoints()}openListElem(){this.mainElem.classList.add("hide-2"),this.clearBtn.classList.add("hide"),this.listElem.classList.remove("hide-2"),this.tableBody.innerHTML="";let t=0;this.stats.gamesPlayed.forEach(e=>{let s=document.createElement("tr");if(e.won&&this.stateArr[this.state][0]||!e.won&&this.stateArr[this.state][1]){let i=document.createElement("td"),a=document.createElement("td"),n=document.createElement("td"),r=document.createElement("td"),o=document.createElement("td"),l=document.createElement("td"),h=document.createElement("td");i.textContent=new Date(e.date).toLocaleString(),a.textContent=e.rows,n.textContent=e.cols,r.textContent=e.mines,o.textContent=e.seed,l.textContent=e.won?"Won":"Lost",h.textContent=e.won?(0,utils.DD)(e.time):"--",e.won&&(h.style.color=e.time<=e.timeRange.minTime?"var(--green)":e.time>e.timeRange.minTime&&e.time<=e.timeRange.maxTime?"var(--yellow)":"var(--red)"),s.append(i,a,n,r,o,l,h),this.tableBody.appendChild(s),t%2||(s.style.backgroundColor="light-dark(#ddf, #333)"),t++}})}backToMain(){this.mainElem.classList.remove("hide-2"),this.clearBtn.classList.remove("hide"),this.listElem.classList.add("hide-2")}}const statsTab=new StatsTab,stats=statsTab;class SettingsTab extends tab.A{themeBtn=(0,utils.Jt)("#theme-select > button");themeDropdown=(0,utils.Jt)("#theme-dropdown");lightThemeBtn=(0,utils.Jt)("#light-theme-btn");darkThemeBtn=(0,utils.Jt)("#dark-theme-btn");sysThemeBtn=(0,utils.Jt)("#sys-theme-btn");zoomRange=(0,utils.Jt)("#zoom-input");zoomTxt=(0,utils.Jt)("#set-zoom-txt");niceStartInput=(0,utils.Jt)("#nice-start-wrap input");savedGameInput=(0,utils.Jt)("#saved-game-wrap input");sensitivityRange=(0,utils.Jt)("#sensitivity-input");showListenerInput=(0,utils.Jt)("#show-listener-wrap input");volumeRange=(0,utils.Jt)("#volume-input");resetBtn=(0,utils.Jt)("#reset-btn");clearBtn=(0,utils.Jt)("#clear-btn");constructor(){super((0,utils.Jt)("#settings-tab"),(0,utils.Jt)("#settings-head button")),document.addEventListener("click",t=>{this.themeBtn.contains(t.target)||this.themeDropdown.contains(t.target)||this.themeDropdown.classList.add("hide-2")}),this.themeBtn.addEventListener("click",()=>{this.themeDropdown.classList.toggle("hide-2")}),[...this.themeDropdown.children].forEach(t=>{let e=t.dataset.val;t.addEventListener("click",()=>{this.app.settings.theme=e,this.themeDropdown.classList.add("hide-2"),this.update()})}),this.initRange((0,utils.Jt)("#def-zoom-range-wrap"),t=>{this.app.settings.defZoom=t,this.zoomTxt.textContent=t+"x"}),this.niceStartInput.oninput=()=>{this.app.settings.niceStart=this.niceStartInput.checked,this.update()},this.savedGameInput.oninput=()=>{this.app.settings.continueSavedGame=this.savedGameInput.checked,this.update()},this.initRange((0,utils.Jt)("#sensitivity-range-wrap"),t=>this.app.settings.scrollSensitivity=t),this.showListenerInput.oninput=()=>{this.app.settings.showListenerPosition=this.showListenerInput.checked,this.update()},this.initRange((0,utils.Jt)("#volume-range-wrap"),t=>{this.app.settings.volume=t/100}),this.volumeRange.onchange=()=>{this.app.audio.play("click")},this.resetBtn.onclick=()=>{this.app.settings.resetToDefault(),this.update()},this.clearBtn.onclick=()=>{tabs_confirm.A.open("This will clear all stats, reset settings to default and reload the page. Continue?",!1).then(t=>{t&&(document.body.classList.add("inactive"),clearInterval(this.app.timerInterval),localStorage.clear(),sessionStorage.clear(),location.reload())})}}update(){let t=this.app.settings;switch(t.theme){case"light":this.themeBtn.innerHTML=this.lightThemeBtn.innerHTML;break;case"dark":this.themeBtn.innerHTML=this.darkThemeBtn.innerHTML;break;case"light dark":this.themeBtn.innerHTML=this.sysThemeBtn.innerHTML}this.zoomRange.value=t.defZoom,this.niceStartInput.checked=t.niceStart,this.savedGameInput.checked=this.app.settings.continueSavedGame,this.sensitivityRange.value=t.scrollSensitivity,this.showListenerInput.checked=this.app.settings.showListenerPosition,this.volumeRange.value=100*this.app.settings.volume,this.app.settings.save()}open(){super.open(),this.update()}initRange(t,e){let s=t.getElementsByTagName("p")[0],i=t.getElementsByTagName("input")[0],a=()=>{s.classList.remove("hide-2");let t=Number(i.min),a=Number(i.max),n=i.valueAsNumber,r=1-(n-t)/(a-t);s.style.right=100*r+"%",s.textContent=n,e(n),this.update()};i.oninput=()=>a(),i.onmouseenter=()=>a(),i.onmouseleave=()=>s.classList.add("hide-2"),document.addEventListener("pointerdown",t=>{i.contains(t.target)||s.classList.add("hide-2")})}}const settingsTab=new SettingsTab,settings=settingsTab;class Menu{menuElem=(0,utils.Jt)("#menu");aboutGameWrap=(0,utils.Jt)("#about-game-wrap");app;constructor(){this.configBtn(),document.addEventListener("pointerdown",t=>{this.menuElem.contains(t.target)||this.menuBtn.contains(t.target)||this.close()});let t=0,e=(0,utils.Jt)("#header");document.addEventListener("scroll",()=>{window.scrollY>t?e.classList.add("hide-up"):e.classList.remove("hide-up"),t=window.scrollY}),this.newGameBtn=this.addItem("New Game","plus"),this.statsBtn=this.addItem("Statistics","stats"),this.settingsBtn=this.addItem("Settings","settings"),this.aboutBtn=this.addItem("About","info"),this.newGameBtn.wrap.classList.add("ctx-elem"),this.newGameBtn.wrap.addEventListener("click",()=>{new_game.A.open()}),(0,utils.$0)(this.newGameBtn.wrap,()=>{this.app.audio.play("click"),new_game.A.open(!0),this.close()}),this.statsBtn.wrap.addEventListener("click",()=>stats.open()),this.settingsBtn.wrap.addEventListener("click",()=>{settings.open()}),this.aboutBtn.wrap.addEventListener("click",()=>{tabs_info.A.open(this.aboutGameWrap),["reddit","facebook-f"].forEach((t,e)=>{(t=>{let e=(0,utils.Jt)(`#link-list div:nth-of-type(${t}) a`);return e.textContent="",e})(e+1).append(this.app.svgs[t])})}),this.aboutGameWrap.remove()}configBtn(){this.menuBtn=(0,utils.Jt)("#menu-btn"),this.btnInput=(0,utils.Jt)("#menu-btn input"),this.btnInput.oninput=()=>{this.btnInput.checked?this.open():this.close()}}items=[];addItem(t,e){let s=new MenuItem(this,t,e);return this.menuElem.appendChild(s.wrap),this.items.push(s),s}open(){(0,utils.Jt)("#menu-btn input").checked=!0,this.menuElem.classList.remove("hide-2")}close(){(0,utils.Jt)("#menu-btn input").checked=!1,this.menuElem.classList.add("hide-2"),this.btnInput.checked=!1}}class MenuItem{constructor(t,e,s){this.menu=t,this.textElem=null,this.svg=null,this.text=e,this.svgName=s,this.wrap=document.createElement("button"),this.wrap.classList.add("menu-item"),this.wrap.addEventListener("click",()=>this.menu.close())}update(){this.wrap.textContent="",this.textElem=document.createElement("div"),this.textElem.textContent=this.text,this.svg=this.menu.app.svgs[this.svgName],this.wrap.appendChild(this.svg),this.wrap.appendChild(this.textElem)}}const menu=new Menu,scripts_menu=menu;class WaitTab extends tab.A{textElem=(0,utils.Jt)("#wait-text");bar=(0,utils.Jt)("#load-bar");barMain=(0,utils.Jt)("#load-bar div");constructor(){super((0,utils.Jt)("#wait-tab"))}open(t="",e=!0){super.open(),this.updateBar(0),e?this.bar.classList.remove("hide-2"):this.bar.classList.add("hide-2"),this.textElem.textContent="","string"==typeof t&&(this.textElem.innerHTML=t)}updateBar(t){this.barMain.style.width=100*t+"%"}}const waitTab=new WaitTab,wait=waitTab;class Statistics{gamesPlayed=[];get won(){return this.gamesPlayed.filter(t=>t.won)}get lost(){return this.gamesPlayed.filter(t=>!t.won)}add(...t){this.gamesPlayed.push(new GameStat(...t)),this.save()}load(){this.gamesPlayed=(0,utils.bQ)("stats")||[]}save(){(0,utils.XO)("stats",this.gamesPlayed)}clear(){this.gamesPlayed=[],this.save()}getPointsFromGame(t){let e=0,s=t.mines/(t.rows*t.cols),i=s*t.mines;if(t.won){let s=t.timeRange.minTime,a=t.timeRange.maxTime;e+=i+i*(t.time<=s?2:t.time>s&&t.time<=a?1:0)}else e-=i*(1-s);return Number(e.toFixed(3))}getMasteryPoints(){let t=0;return this.gamesPlayed.forEach(e=>{t+=this.getPointsFromGame(e)}),Number(t.toFixed(3))}}class GameStat{constructor(t,e,s,i,a,n,r,o){this.rows=e,this.cols=s,this.mines=i,this.seed=a,this.date=t,this.won=n,this.time=r,this.timeRange=o}}class GameEndTab extends tab.A{statusElem=(0,utils.Jt)("#get-status h2");pointsElem=(0,utils.Jt)("#get-status p");playBtn=(0,utils.Jt)("#get-btns-wrap button:first-of-type");confettis=[];constructor(){super((0,utils.Jt)("#game-end-tab"),(0,utils.Jt)("#get-btns-wrap button:not(:first-of-type)"))}open(t){super.open();let e=this.app.stats.gamesPlayed[t];this.statusElem.textContent="You "+(e.won?"Won":"Lost"),this.playBtn.onclick=()=>{this.app.newGame(e.rows,e.cols,e.mines,e.won?(0,utils.XU)(48):e.seed),this.close()},this.playBtn.textContent=e.won?"Play Again":"Retry",this.pointsElem.textContent=(e.won?"+":"-")+this.app.stats.getPointsFromGame(e)+" MP",this.pointsElem.style.color=`var(--${e.won?"green":"red"})`,e.won?this.closeBtn.focus():this.playBtn.focus()}}const gameEndTab=new GameEndTab,end=gameEndTab;class PresetManager{arr=[];default=[new Preset("Easy",9,9,10),new Preset("Medium",16,16,40),new Preset("Hard",16,30,99)];load(){if("yes"==(0,utils.bQ)("first-time"))this.arr.push(...this.default),this.save();else{let t=JSON.parse(localStorage.getItem("presets"));t&&t.forEach(t=>{this.arr.every(e=>e.name!=t.name)&&this.arr.push(new Preset(t.name,t.rows,t.cols,t.mines,t.seed))})}}save(){localStorage.setItem("presets",JSON.stringify(this.arr))}add(t,e,s,i,a){this.arr.every(e=>e.name!=t)&&(this.arr.push(new Preset(...arguments)),this.save())}remove(t){this.arr=this.arr.filter(e=>e.name!=t),this.save()}has(t){return this.arr.some(e=>e.name==t)}}class Preset{constructor(t,e,s,i,a){this.name=t,this.rows=e,this.cols=s,this.mines=i,this.seed=a}}class Settings{_theme="light dark";get theme(){return this._theme}set theme(t){this._theme=t,document.querySelector(":root").style.colorScheme="light"==this.theme?"light":"dark"==this.theme?"dark":"light dark"}_volume=1;get volume(){return this._volume}set volume(t){this._volume=t,this.app.audio.volume.gain.value=this._volume}sqrSize=20;niceStart=!1;scrollSensitivity=1;minZoom=.5;maxZoom=2;defZoom=1;showListenerPosition=!0;continueSavedGame=!1;constructor(t){this.app=t,this.volume=this.volume,this.theme=this.theme}save(){let t={theme:this.theme,niceStart:this.niceStart,scrollSensitivity:this.scrollSensitivity,defZoom:this.defZoom,showListenerPosition:this.showListenerPosition,volume:this.volume,continueSavedGame:this.continueSavedGame};(0,utils.XO)("settings",t)}load(){let t=(0,utils.bQ)("settings");t&&(this.theme=t.theme,this.niceStart=t.niceStart,this.scrollSensitivity=t.scrollSensitivity,this.defZoom=t.defZoom,this.showListenerPosition=t.showListenerPosition,this.volume=t.volume,this.continueSavedGame=t.continueSavedGame)}resetToDefault(){this.theme="light dark",this.volume=1,this.scrollSensitivity=1,this.defZoom=1,this.continueSavedGame=!1,this.showListenerPosition=!0,this.niceStart=!1}}class AudioManager{audios={};ctx=new AudioContext;volume=this.ctx.createGain();spatialAudios=[];constructor(t){this.app=t,this.load("click.wav","click"),this.load("sqr_open.mp3","sqr_open"),this.load("test_audio.mp3","test_audio"),this.load("explosion.wav","explosion"),this.load("unflag.wav","unflag"),this.load("flag.wav","flag"),document.addEventListener("click",t=>{let e=[...document.querySelectorAll("button")],s=[...document.querySelectorAll("input[type='checkbox']")];for(const i of e.concat(s))if(i.contains(t.target)){this.play("click");break}}),this.volume.connect(this.ctx.destination)}load(t,e){return new Promise(async s=>{let i=await this.ctx.decodeAudioData(await(await fetch("./sound/"+t)).arrayBuffer());this.audios[e]=i,s()})}play(t){let e=this.ctx.createBufferSource();e.buffer=this.audios[t],e.connect(this.volume),e.start()}playSpatial(t,e,s){this.ctx.createBufferSource().buffer=this.audios[t];let i=new SpatialAudio(this,t,e,s);this.spatialAudios.push(i),i.src.addEventListener("ended",()=>{this.spatialAudios=this.spatialAudios.filter(t=>t!=i)}),i.play()}resetPos(){this.ctx.listener.positionX.value=Math.ceil(this.app.camera.centerX),this.ctx.listener.positionY.value=Math.ceil(this.app.camera.centerY),this.ctx.listener.positionZ.value=0}reset(){this.resetPos(),this.spatialAudios.forEach(t=>t.src.stop())}}class SpatialAudio{constructor(t,e,s,i){this.manager=t;let a=this.manager.ctx;this.x=s,this.y=i,this.src=a.createBufferSource(),this.src.buffer=this.manager.audios[e],this.pannerNode=a.createPanner(),this.pannerNode.positionX.value=s,this.pannerNode.positionY.value=i,this.pannerNode.refDistance=2*t.app.sqrSize,this.pannerNode.distanceModel="inverse",this.pannerNode.rolloffFactor=5,this.src.connect(this.pannerNode).connect(this.manager.volume)}play(){this.src.start()}}class App{_paused=!1;get paused(){return this._paused}set paused(t){this._paused=t}_elapsed=0;get elapsed(){return this._elapsed}set elapsed(t){this._elapsed=t,(0,utils.Jt)("#time-wrap div").textContent=(0,utils.DD)(this.elapsed);let{minTime:e,maxTime:s}=this.curGameInfo.timeRange;(0,utils.Jt)("#time-wrap svg").style.fill=t<=e?"var(--green)":t>e&&t<=s?"var(--yellow)":"var(--red)"}canvas=(0,utils.Jt)("#game-canvas");ctx=this.canvas.getContext("2d");curGame;curGameInfo=null;savedGame=null;timeCache={};sqrs=[];colorMap=["#fff0","red","orange","gold","green","blue","indigo","violet","black"];explosions=[];flags=[];input=new Input(this);audio=new AudioManager(this);camera=new Camera(this);scrollBar=new ScrollBar(this);sqrSizingBtn=(0,utils.Jt)("#sqr-size-wrap button");sqrSizingRange=(0,utils.Jt)("#sqr-size-wrap input");sqrSizingRangeWrap=(0,utils.Jt)("#sqr-size-wrap > div");gameInfoBtn=(0,utils.Jt)("#game-info-btn");gameInfoWrap=(0,utils.Jt)("#game-info-wrap");presets=new PresetManager;stats=new Statistics;debug=!1;sqrSize=20;settings=new Settings(this);constructor(){(0,utils.bQ)("first-time")?(0,utils.XO)("first-time","no"):(0,utils.XO)("first-time","yes"),this.presets.load(),scripts_menu.app=new_game.A.app=tabs_confirm.A.app=tabs_info.A.app=wait.app=stats.app=end.app=settings.app=this,this.gameInfoBtn.onclick=()=>{tabs_info.A.open(this.gameInfoWrap);let t=" p:nth-of-type(2)",e=(0,utils.Jt)("#gi-rows"+t),s=(0,utils.Jt)("#gi-cols"+t),i=(0,utils.Jt)("#gi-mines"+t),a=(0,utils.Jt)("#gi-seed"+t),n=(0,utils.Jt)("#gi-fs"+t),r=(0,utils.Jt)("#gi-time"+t),o=(0,utils.Jt)("#gi-date"+t),l=this.curGameInfo;e.textContent=l.rows,s.textContent=l.cols,i.textContent=l.mines,a.textContent=l.seed,n.textContent=l.fullSeed,r.textContent=(0,utils.DD)(l.timeRange.minTime)+(l.timeRange.minTime!=l.timeRange.maxTime?" - "+(0,utils.DD)(l.timeRange.maxTime):""),o.textContent=new Date(l.date).toLocaleString()},(0,utils.Jt)("#opened-wrap").onclick=()=>{tabs_info.A.open("This shows the squares that have been opened over the sqaures to be opened to win the game.")},this.loadSVGs().then(()=>{this.addSVGs(),this.settings.load(),this.flagImg=document.createElement("img"),this.flagImg.src="./svgs/flag.svg",this.explosionImg=document.createElement("img"),this.explosionImg.src="./imgs/explosion.png",(0,utils.Jt)("#load-wrap").classList.add("hide"),this.stats.load(),this.timeCache=(0,utils.bQ)("time-cache",!0)||{},this.savedGame=(0,utils.bQ)("saved-game");let t=(0,utils.bQ)("new-game-props")||{rows:9,cols:9,mines:10};this.savedGame?this.settings.continueSavedGame?this.continueSavedGame():tabs_confirm.A.open("Continue saved game? Not doing so will count as a loss in your statistics.").then(e=>{if(e)this.continueSavedGame();else{let e=minesweeper.default.createFromString(this.savedGame.gameData);this.stats.add(this.savedGame.date,e.rows,e.cols,e.mines,e.seed,!1,this.savedGame.elapsed,this.savedGame.timeRange),this.newGame(t.rows,t.cols,t.mines,(0,utils.XU)(48))}}):this.newGame(t.rows,t.cols,t.mines,(0,utils.XU)(48))}),this.gameInfoWrap.remove()}svgs={};loadSVGs(){return new Promise(t=>{let e=["info","flag","stopwatch","plus","stats","settings","tick","x","rotate","save","dice","trash-can","back","sun","moon","laptop","facebook-f","reddit","envelope"],s=0;e.forEach(async(i,a)=>{let n=document.createElement("div");n.innerHTML=await(await fetch("svgs/"+i+".svg")).text(),Object.defineProperty(this.svgs,i,{get:()=>n.getElementsByTagName("svg")[0].cloneNode(!0)}),s++,s==e.length&&t()})})}addSVGs(){let t=this.svgs;(0,utils.Jt)("#game-info-btn").append(t.info),(0,utils.Jt)("#flags-wrap").prepend(t.flag),(0,utils.Jt)("#time-wrap").prepend(t.stopwatch),(0,utils.Jt)("#ct-ok-btn").append(t.tick),(0,utils.Jt)("#top-wrap button:first-of-type").append(t.rotate),(0,utils.Jt)("#top-wrap button:nth-of-type(2)").append(t.info),(0,utils.Jt)("#rand-seed-btn").append(t.dice),(0,utils.Jt)("#preset-save-btn").append(t.save),(0,utils.Jt)("#clear-stats-btn").append(t["trash-can"]),(0,utils.Jt)("#sl-back-btn").append(t.back),(0,utils.Jt)("#light-theme-btn").prepend(t.sun),(0,utils.Jt)("#dark-theme-btn").prepend(t.moon),(0,utils.Jt)("#sys-theme-btn").prepend(t.laptop),document.querySelectorAll(".cancel-btn").forEach(e=>{e.append(t.x)}),scripts_menu.items.forEach(t=>t.update())}continueSavedGame(){let t=this.savedGame;this.curGame=minesweeper.default.createFromString(t.gameData),this.sqrs=[],this.curGame.sqrs.forEach(t=>{this.sqrs.push(new AppSquare(this,t.row,t.col,t.mineCount,t.opened,t.flagged))}),this.timeCache[this.curGame.fullSeed]=t.timeRange,(0,utils.XO)("time-cache",this.timeCache,!0),this.updateGameInfo(),this.sqrSize=this.settings.sqrSize,this.camera.x=t.camera.x,this.camera.y=t.camera.y,this.camera.zoom=t.camera.zoom,this.audio.reset(),this.elapsed=t.elapsed,this.updateFlagElem(),this.updateOpenedElem(),this.stopUpdateLoop(),this.startUpdateLoop()}waiting=!1;newGame(t,e,s,i,a=!1){let n=()=>{if(this.removeSave(),this.curGame=new minesweeper.default(t,e,s,i),(0,utils.XO)("new-game-props",{rows:t,cols:e,mines:s}),this.explosions.forEach(t=>t.destroy()),this.flags.forEach(t=>t.destroy()),this.stopUpdateLoop(),clearTimeout(this.endTabTimeout),this.waiting=!1,a?this.startUpdateLoop():(this.waiting=!0,wait.open("Creating Game")),this.updateGameInfo(),this.sqrs=[],this.curGame.sqrs.forEach(t=>{this.sqrs.push(new AppSquare(this,t.row,t.col,t.mineCount))}),this.updateFlagElem(),this.updateOpenedElem(),this.sqrSize=this.settings.sqrSize,this.camera.x=0,this.camera.y=0,this.camera.zoom=this.settings.defZoom,this.audio.reset(),this.resetTimer(),this.settings.niceStart)for(let t=0;t<9;t++){let e=this.curGame.sqrs.filter(e=>e.mineCount==t);if(e.length>0){let t=e[Math.floor(Math.random()*e.length)],s=this.sqrs.find(e=>e.row==t.row&&e.col==t.col);s.overlayColor="green",this.camera.origin={x:.5,y:.5},this.camera.x=s.x,this.camera.y=s.y;break}}};!this.curGame||a||!this.curGame.started||this.curGame.ended?n():tabs_confirm.A.open("You haven't finished the game you started. Creating a new game will count as a loss in your statistics.",!1).then(t=>{t&&(this.stats.add(this.curGameInfo.date,this.curGameInfo.rows,this.curGameInfo.cols,this.curGameInfo.mines,this.curGameInfo.seed,!1,this.elapsed,this.curGameInfo.timeRange),n())})}updateGameInfo(){this.curGameInfo={rows:this.curGame.rows,cols:this.curGame.cols,mines:this.curGame.mines,seed:this.curGame.seed,fullSeed:this.curGame.fullSeed,date:Date.now(),timeRange:{minTime:0,maxTime:0}},this.getEstTime(this.curGame.fullSeed,t=>{t.val?wait.updateBar(t.val):(this.curGameInfo.timeRange=t,wait.updateBar(1),wait.close(),this.waiting&&(this.waiting=!1,this.startUpdateLoop()))})}getEstTime(t,e){if(this.timeCache[t])return void e(this.timeCache[t]);let s=new Worker(new URL(__webpack_require__.p+__webpack_require__.u(451),__webpack_require__.b));return s.addEventListener("message",i=>{e(i.data),i.data.val||(this.timeCache[t]=i.data,(0,utils.XO)("time-cache",this.timeCache,!0),s.terminate())}),s.postMessage(t),s}markRiggedSqrs(){this.curGame.rigged.forEach(t=>{this.sqrs.find(e=>e.row==t.row&&e.col==t.col).overlayColor="red"})}saveGame(){let t=this.curGameInfo;this.savedGame={gameData:this.curGame.getStringData(),timeRange:t.timeRange,date:t.date,camera:this.camera.obj,elapsed:this.elapsed},(0,utils.XO)("saved-game",this.savedGame)}removeSave(){this.savedGame=null,(0,utils.XO)("saved-game",null)}openSqr(t){if(!this.curGame.ended){this.curGame.started||this.sqrs.forEach(t=>t.overlayColor=null),this.timerRunning||this.startTimer();let e=t.row,s=t.col;this.curGame.openSqr(e,s);let i=this.curGame.openedArr;if(this.curGame.ended&&(this.stopTimer(),this.removeSave(),this.stats.add(this.curGameInfo.date,this.curGameInfo.rows,this.curGameInfo.cols,this.curGameInfo.mines,this.curGameInfo.seed,this.curGame.won,this.elapsed,this.curGameInfo.timeRange),this.endTabTimeout=setTimeout(()=>end.open(this.stats.gamesPlayed.length-1),2e3)),this.curGame.failed&&i.length){let t=i.find(t=>t.rigged&&t.opened),e=this.sqrs.find(e=>e.row==t.row&&e.col==t.col);return void this.startFailSys(e)}if(this.curGame.won){let t=9;this.pourConfetti(10);let e=setInterval(()=>{this.pourConfetti(10),t--,t||clearInterval(e)},500)}this.curGame.openedArr.forEach(t=>{let e=this.sqrs.find(e=>e.row==t.row&&e.col==t.col);this.addTimeEvent(()=>{e.opened=!0,e.input=!0,t.mineCount||this.audio.playSpatial("sqr_open",e.x,e.y)},100*t.chainCount),e.input=!1}),this.updateOpenedElem()}}flagSqr(t){let e=t.flagged;!this.curGame.started||this.curGame.ended||this.timerRunning||this.startTimer();let s=t.row,i=t.col;this.curGame.toggleFlag(s,i),t.flagged=this.curGame.sqrAt(s,i).flagged,!t.flagged&&e?new Flag(this,t.x,t.y).leave():t.flagged&&!e&&this.audio.play("flag"),this.updateFlagElem()}updateFlagElem(){(0,utils.Jt)("#flags-wrap > div").textContent=this.curGame.flagCount}updateOpenedElem(){(0,utils.Jt)("#opened-wrap").textContent=this.curGame.opened.length+" / "+(this.curGame.sqrs.length-this.curGame.rigged.length)}pourConfetti(t){let e=["red","orange","yellow","green","blue"];for(let s=0;s<t;s++){let t=document.createElement("div");t.classList.add("confetti"),t.style.backgroundColor=e[(0,utils.yT)(0,e.length-1)],t.style.top="0px",t.style.left=(0,utils.yT)(0,100)+"vw",t.style.width=(0,utils.yT)(10,20)+"px",(0,utils.Jt)("#confetti-wrap").appendChild(t);let s=(0,utils.yT)(1e3,5e3),i=parseInt(getComputedStyle(t).left),a=(0,utils.yT)(-200,200);t.animate([{top:"100vh",left:i+a+"px"}],{duration:s,fill:"forwards"});let n=(0,utils.yT)(0,360);t.animate([{transform:`rotateZ(${n}deg)`},{transform:`rotateZ(${n}deg) rotateX(360deg)`}],{duration:500,iterations:1/0}),t.animate([{opacity:0}],{duration:500,delay:s-500,fill:"forwards"}).addEventListener("finish",()=>t.remove())}}failTimeEvents=[];startFailSys(t){let e=(t,e)=>this.sqrs.find(s=>s.row==t&&s.col==e);this.curGame.rigged.filter(t=>!t.flagged).concat(this.curGame.sqrs.filter(t=>!t.rigged&&t.flagged)).sort((s,i)=>{let a=e(s.row,s.col),n=e(i.row,i.col);return Math.hypot(a.x-t.x,a.y-t.y)-Math.hypot(n.x-t.x,n.y-t.y)}).forEach((t,s)=>{let i=e(t.row,t.col),a=!1,n=()=>{let t=new ExplosionSprite(this,i.x,i.y).explode();t.timeObjs[1].addEventListener("complete",()=>t.destroy()),t.timeObjs[1].addEventListener("update",t=>{if(t.detail.value>=.5&&!a){a=!0;let t=new ExplosionSprite(this,i.x,i.y,10);t.alpha=.5,t.scale=.9}})};if(0==s)n();else{let e=this.addTimeEvent(()=>{if(t.flagged){i.flagged=!1;let t=new Flag(this,i.x,i.y);t.velocity.y=-5,t.acceleration.y=.1,t.velocity.x=6*Math.random()-3;let e=[.01,-.01];t.angularAcceleration=e[Math.floor(Math.random()*e.length)],t.maxAngularVelocity=.05,t.leave()}else n()},50*s+1e3);this.failTimeEvents.push(e)}})}timerInterval;timerRunning=!1;startTimer(){this.stopTimer(),this.timerRunning=!0,this.timerInterval=setInterval(()=>{this.elapsed++,this.saveGame()},1e3)}resetTimer(){this.stopTimer(),this.elapsed=0}stopTimer(){clearInterval(this.timerInterval),this.timerRunning=!1}sizeCanvas(){let{width:t,height:e}=(0,utils.Jt)("#canvas-wrap").getBoundingClientRect();this.canvas.width=t,this.canvas.height=e,this.camera.width=Math.floor(this.canvas.width/devicePixelRatio),this.camera.height=Math.floor(this.canvas.height/devicePixelRatio)}addTimeEvent(t,e,s){let i=new TimeEvent(t,e,s);return this.timeEvents.push(i),i}addCounter(t){return new Counter(this,t)}animFrame;fps=60;curFPS=0;startUpdateLoop(){this.running=!0;let t=0,e=s=>{if(!this.paused&&s-t){let e=s-t;t=s,1e3/e>=5&&this.update(e)}this.running&&(this.animFrame=requestAnimationFrame(e))};e()}timeEvents=[];update(t){this.sizeCanvas(),this.timeEvents.forEach(e=>e.update(t)),this.timeEvents=this.timeEvents.filter(t=>t.loopsLeft),this.flags.forEach(e=>e.update(t)),this.camera.update(t),this.draw(t)}running=!1;stopUpdateLoop(){this.timeEvents=[],this.running=!1,cancelAnimationFrame(this.animFrame)}draw(t){let e=this.ctx;e.reset(),e.fillStyle="#ccf",e.fillRect(0,0,this.canvas.width,this.canvas.height),e.scale(devicePixelRatio,devicePixelRatio),e.translate(this.camera.x,this.camera.y),e.scale(this.camera.zoom,this.camera.zoom),e.translate(-this.camera.x/this.camera.zoom-this.camera.startX,-this.camera.y/this.camera.zoom-this.camera.startY);let s=e.getTransform();e.setTransform(s.a,s.b,s.c,s.d,Math.ceil(s.e),Math.ceil(s.f)),e.save();let i=t=>t.startX<this.camera.endX&&t.endX>this.camera.startX&&t.startY<this.camera.endY&&t.endY>this.camera.startY,a=t=>"#aaf"==t?"#bbf":"#aaf",n="#bbf";if(this.sqrs.forEach(t=>{if(i(t))if(e.restore(),e.save(),t.opened){if(e.fillStyle="#ddf",e.fillRect(t.startX,t.startY,this.sqrSize,this.sqrSize),t.mineCount){e.fillStyle=this.colorMap[t.mineCount]||"grey",e.textAlign="center",e.textBaseline="top",e.font=this.sqrSize+"px monospace";let s=e.measureText(t.mineCount),i=s.actualBoundingBoxDescent-s.actualBoundingBoxAscent;e.fillText(t.mineCount,t.x,t.y-i/2)}}else{e.globalAlpha=t.alpha;let s=t.row%2?n:a(n),i=t.col%2?s:a(s);e.fillStyle=i;let r=this.sqrSize;if(e.fillRect(t.startX,t.startY,r,r),t.overlayColor&&(e.fillStyle=t.overlayColor,e.fillRect(t.startX,t.startY,r,r)),t.flagged){let s=.8*r,i=this.flagImg.height/this.flagImg.width*s;e.translate(t.x,t.y),e.drawImage(this.flagImg,-s/2,-i/2,s,i)}}}),this.flags.forEach(t=>t.draw()),this.explosions.forEach(t=>{e.restore(),e.save(),i(t)&&t.draw()}),this.scrollBar.draw(),this.settings.showListenerPosition){e.restore(),e.save(),e.globalAlpha=.7;let t=this.audio.ctx.listener;e.fillStyle="yellow",e.beginPath(),e.arc(t.positionX.value,t.positionY.value,this.sqrSize/5,0,2*Math.PI),e.fill()}if(this.debug){e.resetTransform(),e.globalAlpha=1,e.scale(devicePixelRatio,devicePixelRatio),e.fillStyle="black",e.font="30px arial",e.textBaseline="top";let s=Math.round(1e3/t),i=e.measureText(s);e.fillText(s,this.canvas.width-i.width-5,this.canvas.height-i.actualBoundingBoxDescent-i.actualBoundingBoxAscent-5)}}}window.app=new App})();